{% extends "partners/base.html" %}

{% load static %}

{% block custom_css %}
<style>
hr {
  margin-top: 2rem;
  margin-bottom: 1rem;
  width: 50%;
  border: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.work-history-form {
    height:968px;
    overflow-y:auto;
    position:relative;
}

</style>
{% endblock custom_css %}

{% block title %}
    My Work Experiences
{% endblock title %}


{% block page_title %}
    My Work Experiences
{% endblock page_title %}

{% block page_content %}
    <form id="experienceForm">
    {% csrf_token %}
    <div class="row">
        <div class="col-12">
            <div class="row mt-4">
                <div class="col-12 col-lg-6 offset-lg-3">
                    <div class="card">
                        <div class="card-body">
                            <p class="lead">Add Work Experiences</p>
                            
                            <!-- Work histories -------------------------------->
                            <div id="accordion">
                                <div class="accordion">
                                    <div class="accordion-header collapsed" role="button" data-toggle="collapse" data-target="#panel-body-1" aria-expanded="false">
                                        <h4>Work History #1</h4>
                                    </div>
                                    <div class="accordion-body collapse" id="panel-body-1" data-parent="#accordion" style="">
                                        <div class="col-lg-12">
                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Designation</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_designation_1" class="form-control work_designation_1">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Phone</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_phone_number_1" class="form-control work_phone_number_1">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Email</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="email" name="work_email_1" class="form-control work_email_1">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Name</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_office_name_1" class="form-control work_office_name_1">
                                                </div>
                                            </div>
                                            
                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Address</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input name="work_office_address_1" class="form-control work_office_address_1">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Start Date</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_start_date_1" class="form-control work_start_date_1" placeholder="YYYY-MM-DD">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">End Date</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_end_date_1" class="form-control work_end_date_1" placeholder="YYYY-MM-DD">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Responsibilities</label>
                                                <div class="col-lg-12 mt-0">
                                                    <textarea class="form-control work_responsibility_1" name="work_responsibility_1" id="work_responsibility_1"></textarea>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="accordion">
                                    <div class="accordion-header collapsed" role="button" data-toggle="collapse" data-target="#panel-body-2" aria-expanded="false">
                                        <h4>Work History #2</h4>
                                    </div>
                                    <div class="accordion-body collapse" id="panel-body-2" data-parent="#accordion" style="">
                                        <div class="col-lg-12">
                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Designation</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_designation_2" class="form-control work_designation_2">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Phone</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_phone_number_2" class="form-control work_phone_number_2">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Email</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="email" name="work_email_2" class="form-control work_email_2">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Name</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_office_name_2" class="form-control work_office_name_2">
                                                </div>
                                            </div>
                                            
                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Address</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input name="work_office_address_2" class="form-control work_office_address_2">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Start Date</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_start_date_2" class="form-control work_start_date_2" placeholder="YYYY-MM-DD">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">End Date</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_end_date_2" class="form-control work_end_date_2" placeholder="YYYY-MM-DD">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Responsibilities</label>
                                                <div class="col-lg-12 mt-0">
                                                    <textarea class="form-control work_responsibility_2" name="work_responsibility_2" id="work_responsibility_2"></textarea>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="accordion">
                                    <div class="accordion-header" role="button" data-toggle="collapse" data-target="#panel-body-3">
                                        <h4>Work History #3</h4>
                                    </div>
                                    <div class="accordion-body collapse" id="panel-body-3" data-parent="#accordion">
                                        <div class="col-lg-12">
                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Designation</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_designation_3" class="form-control work_designation_3">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Phone</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_phone_number_3" class="form-control work_phone_number_3">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Email</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="email" name="work_email_3" class="form-control work_email_3">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Name</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_office_name_3" class="form-control work_office_name_3">
                                                </div>
                                            </div>
                                            
                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Office Address</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input name="work_office_address_3" class="form-control work_office_address_3">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Start Date</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_start_date_3" class="form-control work_start_date_3" placeholder="YYYY-MM-DD">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">End Date</label>
                                                <div class="col-lg-12 mt-0">
                                                    <input type="text" name="work_end_date_3" class="form-control work_end_date_3" placeholder="YYYY-MM-DD">
                                                </div>
                                            </div>

                                            <div class="form-group mb-2">
                                                <label class="col-lg-12 mb-1">Responsibilities</label>
                                                <div class="col-lg-12 mt-0">
                                                    <textarea class="form-control work_responsibility_3" name="work_responsibility_3" id="work_responsibility_3"></textarea>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- endWork -------------------------------->

                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-body">

                            <div class="row mb-5">
                                <div class="col-lg-12">
                                    <div class='progress mb-3' style="height:auto">
                                        <div class="progress-bar bg-warning" id="progressbar" role="progressbar" data-width="0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="display:none;width: 0%;height: 15px;border-radius: 15px;">0%</div>
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary btn-block submit_btn mt-5">SAVE WORK EXPERIENCES</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </form>
{% endblock page_content %}

{% block custom_js %}
<script src="//cdn.tiny.cloud/1/f2rkbc3dctxrbtvg56h17qkspz197y3fd9q28dnwt2frj6gj/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="{% static 'partners/modules/sweetalert/sweetalert.min.js' %}"></script>
<script src="{% static 'partners/js/page/modules-sweetalert.js' %}"></script>

<script>
    tinymce.init({
        selector: "textarea#work_responsibility_1",
        height: 300,
        menubar: false,
        plugins: [
            "lists",
        ],
        toolbar: "insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",
        force_br_newlines : true,
        force_p_newlines : false,
    });
</script>

<script>
    tinymce.init({
        selector: "textarea#work_responsibility_2",
        height: 300,
        menubar: false,
        plugins: [
            "lists",
        ],
        toolbar: "insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",
        force_br_newlines : true,
        force_p_newlines : false,
    });
</script>

<script>
    tinymce.init({
        selector: "textarea#work_responsibility_3",
        height: 300,
        menubar: false,
        plugins: [
            "lists",
        ],
        toolbar: "insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",
        force_br_newlines : true,
        force_p_newlines : false,
    });
</script>

<script>
        
    /*
        Ajax request
        Sending data to server
    */
    $(".submit_btn").click(function(){

        var form = new FormData($("#experienceForm")[0]);

        for (i=0; i < tinyMCE.editors.length; i++){
            var content = tinyMCE.editors[i].getContent();

            if (i==0) {
                form.append("work_responsibility_1", content);
            }
            if (i==1) {
                form.append("work_responsibility_2", content);
            }
            if (i==2) {
                form.append("work_responsibility_3", content);
            }
        }
        
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.status == 200){
                console.log(xhr.responseText);
            }
        }
        xhr.open("POST","{% url 'partners:partner_work_experiences_view' %}", true);

        $("#progressbar").show();

        xhr.upload.addEventListener("progress", function(ev) {
            if(ev.lengthComputable) {
                var percentage = (ev.loaded/ev.total*100|0);
                $("#progressbar").css({"width":""+percentage+"%"}).text("Uploaded .."+percentage+"%");
                setTimeout(function(){
                    $(document).ready(function() {
                        swal('Success', 'You just added work experiences!', 'success').then(function() {
                            window.location.href = "{% url 'partners:partner_resume_panel_view' %}";
                    })});
                }, 1000);
                
            }
            
        });

        xhr.send(form);
        
    })

</script>

{% endblock custom_js %}